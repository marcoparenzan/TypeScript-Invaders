function start_game(){var n=this;this.timerToken=setInterval(function(){n.game_level.render(game_level),n.game_level.update(game_level)},33)}function stop_game(){clearTimeout(this.timerToken)}var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},Sprite=function(){function n(n,t,i,r,u){this.id=n,this.type=t,this.x=i,this.y=r,this.frames=u}return n.prototype.collides=function(n){if(this.collides_callback!=undefined)return this.collides_callback(this,n);if(this.bounding_ray==0||n.bounding_ray==0)return!1;var t=this.x-n.x,i=this.y-n.y,r=t*t+i*i,u=Math.sqrt(r);return u<this.bounding_ray+n.bounding_ray?!0:!1},n.prototype.collided=function(){},n.prototype.render=function(n){this.render_callback!=undefined?this.render_callback(this,n):n.drawImage(this.frames,this.x-this.frames.width/2,this.y-this.frames.height/2)},n.prototype.update=function(n){this.update_callback!=undefined&&this.update_callback(this,n)},n.prototype.move=function(n,t){this.move_callback!=undefined?this.move_callback(this,n,t):(this.x+=n,this.y+=t)},n}(),Ship=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/ship.png",n.call(this,t,"ship",i,r,u),this.bounding_ray=10,this.energy=100,this.shoot_power=10}return __extends(t,n),t.prototype.add_energy=function(n){this.energy+=n,this.energy>100&&(this.energy=100)},t.prototype.increase_shoot_power=function(){this.shoot_power+=10},t.prototype.collided=function(n,t){if(n instanceof Enemy){var i=n;this.energy-=i.energy,this.energy<=0&&t.loose_life()}},t.prototype.shoot=function(n){var t=new ShipBullet("",this.x,this.y);n.add_ship_bullet(t)},t}(Sprite),ShipBullet=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/bullet.png",n.call(this,t,"bullet",i,r,u),this.bounding_ray=7,this.energy=10}return __extends(t,n),t.prototype.update=function(n){this.move(0,-5),this.y<0&&n.remove_ship_bullet(this)},t.prototype.collided=function(n,t){t.remove_ship_bullet(this)},t}(Sprite),EnemyBullet=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/bullet.png",n.call(this,t,"bullet",i,r,u),this.bounding_ray=7,this.energy=5}return __extends(t,n),t.prototype.update=function(n){this.move(0,5),this.y>500&&n.remove_enemy_bullet(this)},t.prototype.collided=function(n,t){t.remove_enemy_bullet(this)},t}(Sprite),Bonus=function(n){function t(t,i,r,u){var f=new Image;this.type=u,this.bounding_ray=7;switch(u){case"life":f.src="assets/images/bonus-life.png";break;case"energy":f.src="assets/images/bonus-energy.png";break;case"power":f.src="assets/images/bonus-power.png";break;case"coin":f.src="assets/images/bonus-coin.png"}n.call(this,t,"bonus",i,r,f)}return __extends(t,n),t.prototype.collided=function(n,t){if(n instanceof ShipBullet)switch(this.type){case"life":t.add_life();break;case"energy":t.main.add_energy(50);break;case"power":t.main.increase_shoot_power();break;case"coin":t.scores(100)}t.remove_bonus(this)},t}(Sprite),Animation=function(n){function t(t,i,r,u){var f=new Image;this.type=u,this.bounding_ray=7;switch(u){case"life":f.src="assets/images/bonus-life.png";break;case"energy":f.src="assets/images/bonus-energy.png";break;case"power":f.src="assets/images/bonus-power.png";break;case"coin":f.src="assets/images/bonus-coin.png"}n.call(this,t,"bonus",i,r,f)}return __extends(t,n),t}(Sprite),Enemy=function(n){function t(t,i,r,u,f){n.call(this,t,i,r,u,f),this.bounding_ray=20,this.energy=10,this.score=100}return __extends(t,n),t}(Sprite),BaseEnemy=function(n){function t(t,i,r,u,f){this.direction_left_to_right=!0,this.count=30,this.down_times=0,n.call(this,t,i,r,u,f),this.bounding_ray=15,this.energy=10,this.score=100}return __extends(t,n),t.prototype.update=function(){this.count>0?(this.direction_left_to_right?this.move(5,0):this.move(-5,0),this.count--):(this.move(0,5),this.direction_left_to_right=!this.direction_left_to_right,this.count=30,this.down_times++,this.down_times>=100&&stop_game())},t.prototype.collided=function(n,t){if(n instanceof ShipBullet){var i=n;this.energy-=i.energy,this.energy<=0&&(t.scores(this.score),t.remove_enemy(this))}},t}(Enemy),EnemyBlue=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/enemy-blue.png",n.call(this,t,"enemy",i,r,u)}return __extends(t,n),t}(BaseEnemy),EnemyRed=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/enemy-red.png",n.call(this,t,"enemy",i,r,u)}return __extends(t,n),t}(BaseEnemy),EnemyYellow=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/enemy-yellow.png",n.call(this,t,"enemy",i,r,u)}return __extends(t,n),t}(BaseEnemy),EnemyGreen=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/enemy-green.png",n.call(this,t,"enemy",i,r,u)}return __extends(t,n),t}(BaseEnemy),EnemyPink=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/enemy-pink.png",n.call(this,t,"enemy",i,r,u)}return __extends(t,n),t}(BaseEnemy),EnemyCyan=function(n){function t(t,i,r){var u=new Image;u.src="assets/images/enemy-cyan.png",n.call(this,t,"enemy",i,r,u)}return __extends(t,n),t}(BaseEnemy),GameLevel=function(){function n(n){var i,t;for(this.back_buffer_context=n,this.enemies=[],this.enemy_bullets=[],this.ship_bullets=[],this.bonuses=[],this.animations=[],this.main=new Ship("main",500,500),i=0,t=0;t<10;t++)this.enemies.push(new EnemyBlue("enemy"+i+t,100+t*50,20+i*50));for(i++,t=0;t<10;t++)this.enemies.push(new EnemyRed("enemy"+i+t,100+t*50,20+i*50));for(i++,t=0;t<10;t++)this.enemies.push(new EnemyGreen("enemy"+i+t,100+t*50,20+i*50));for(i++,t=0;t<10;t++)this.enemies.push(new EnemyYellow("enemy"+i+t,100+t*50,20+i*50));for(i++,t=0;t<10;t++)this.enemies.push(new EnemyPink("enemy"+i+t,100+t*50,20+i*50));for(i++,t=0;t<10;t++)this.enemies.push(new EnemyCyan("enemy"+i+t,100+t*50,20+i*50));this.lives=3,this.score=0}return n.prototype.render=function(n){this.back_buffer_context.clearRect(0,0,this.back_buffer_context.canvas.width,this.back_buffer_context.canvas.height),this.enemies.forEach(function(t){t.render(n.back_buffer_context)}),this.enemy_bullets.forEach(function(t){t.render(n.back_buffer_context)}),this.ship_bullets.forEach(function(t){t.render(n.back_buffer_context)}),this.bonuses.forEach(function(t){t.render(n.back_buffer_context)}),this.main.render(n.back_buffer_context),n.back_buffer_context.strokeText("SCORE: "+this.score.toString(),10,20),n.back_buffer_context.strokeText("LIVES: "+this.lives.toString(),10,45)},n.prototype.update=function(n){var i,t,r,u;for(this.enemies.forEach(function(t){t.update(n)}),this.enemy_bullets.forEach(function(t){t.update(n)}),this.ship_bullets.forEach(function(t){t.update(n)}),this.bonuses.forEach(function(t){t.update(n)}),this.main.update(n),i=0;;){if(n.enemies.length==i)break;if(t=n.enemies[i],this.main.collides(t)){this.main.collided(t,this),t.collided(this.main,this);break}else for(r=0;;){if(n.ship_bullets.length==r)break;u=n.ship_bullets[r],t.collides(u)&&(u.collided(t,this),t.collided(u,this)),r++}i++}},n.prototype.add_ship_bullet=function(n){this.ship_bullets.push(n)},n.prototype.add_enemy_bullet=function(n){this.enemy_bullets.push(n)},n.prototype.add_life=function(){this.lives++},n.prototype.scores=function(n){this.score+=n},n.prototype.loose_life=function(){this.lives--,this.lives==0&&stop_game()},n.prototype.remove_enemy_bullet=function(n){this.enemy_bullets.splice(this.enemy_bullets.indexOf(n),1)},n.prototype.remove_ship_bullet=function(n){this.ship_bullets.splice(this.ship_bullets.indexOf(n),1)},n.prototype.remove_bonus=function(n){this.bonuses.splice(this.bonuses.indexOf(n),1)},n.prototype.remove_enemy=function(n){this.enemies.splice(this.enemies.indexOf(n),1)},n.prototype.shoot=function(){this.main.shoot(this)},n.prototype.move_left=function(){this.main.move(-5,0)},n.prototype.move_right=function(){this.main.move(5,0)},n}(),main_canvas,main_context,back_buffer_canvas,back_buffer_context,game_level,timerToken;$(function(){main_canvas=document.getElementById("main"),main_context=main_canvas.getContext("2d"),back_buffer_canvas=document.getElementById("back_buffer"),back_buffer_context=back_buffer_canvas.getContext("2d"),main_context.font="12pt Calibri",main_context.lineWidth=3,main_context.strokeStyle="blue",game_level=new GameLevel(main_context),start_game()}),window.onkeydown=function(n){n.keyCode==77?game_level.move_right():n.keyCode==78?game_level.move_left():n.keyCode==90&&game_level.shoot()}