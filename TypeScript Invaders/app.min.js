var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Sprite=function(){function n(n,t,i,r,u){this._id=n,this._type=t,this._x=i,this._y=r,this._sprite_sheet=u}return n.prototype.collides=function(n){if(this._bounding_ray==0||n._bounding_ray==0)return!1;var t=this._x-n._x,i=this._y-n._y,r=t*t+i*i,u=Math.sqrt(r);return u<this._bounding_ray+n._bounding_ray?!0:!1},n.prototype.collided=function(){},n.prototype.update=function(){},n.prototype.render=function(n){n.draw(this._sprite_sheet,this._x,this._y)},n.prototype.move=function(n,t){this._x+=n,this._y+=t},n}(),Ship=function(n){function t(t,i,r){var u=new SpriteSheet("assets/images/ship.png");n.call(this,t,"ship",i,r,u),this._bounding_ray=10,this._energy=100,this._shoot_power=10}return __extends(t,n),t.prototype.add_energy=function(n){this._energy+=n,this._energy>100&&(this._energy=100)},t.prototype.increase_shoot_power=function(){this._shoot_power+=10},t.prototype.collided=function(n,t,i){if(n instanceof Enemy){var r=n;this._energy-=r._energy,this._energy<=0&&t.loose_life(i)}},t.prototype.shoot=function(n){var t=new ShipBullet("",this._x,this._y);n.add_ship_bullet(t)},t}(Sprite),ShipBullet=function(n){function t(t,i,r){var u=new SpriteSheet("assets/images/bullet.png");n.call(this,t,"bullet",i,r,u),this._bounding_ray=7,this._energy=10}return __extends(t,n),t.prototype.update=function(n){this.move(0,-5),this._y<0&&n.remove_ship_bullet(this)},t.prototype.collided=function(n,t){t.remove_ship_bullet(this)},t}(Sprite),EnemyBullet=function(n){function t(t,i,r){var u=new SpriteSheet("assets/images/bullet.png");n.call(this,t,"bullet",i,r,u),this._bounding_ray=7,this._energy=5}return __extends(t,n),t.prototype.update=function(n){this.move(0,5),this._y>500&&n.remove_enemy_bullet(this)},t.prototype.collided=function(n,t){t.remove_enemy_bullet(this)},t}(Sprite),Bonus=function(n){function t(t,i,r,u){this._type=u,this._bounding_ray=7;var f=undefined;switch(u){case"life":f=new SpriteSheet("assets/images/bonus-life.png");break;case"energy":f=new SpriteSheet("assets/images/bonus-energy.png");break;case"power":f=new SpriteSheet("assets/images/bonus-power.png");break;case"coin":f=new SpriteSheet("assets/images/bonus-coin.png")}n.call(this,t,"bonus",i,r,f)}return __extends(t,n),t.prototype.collided=function(n,t,i){if(n instanceof ShipBullet)switch(this._type){case"life":i.add_life();break;case"energy":t.add_energy_to_main(50);break;case"power":t.increase_shoot_power_to_main();break;case"coin":i.add_score(100)}t.remove_bonus(this)},t}(Sprite),Enemy=function(n){function t(t,i,r,u,f){n.call(this,t,i,r,u,f),this._energy=10,this._score=100,this._bounding_ray=15}return __extends(t,n),t.prototype.update=function(){},t.prototype.collided=function(){},t}(Sprite),Invader=function(n){function t(t,i,r,u){var f=new SpriteSheet("assets/images/enemy-"+i+".png");n.call(this,t,"enemy",r,u,f),this._direction_left_to_right=!0,this._count=30,this._down_times=0}return __extends(t,n),t.prototype.update=function(){this._count>0?(this._direction_left_to_right?this.move(5,0):this.move(-5,0),this._count--):(this.move(0,5),this._direction_left_to_right=!this._direction_left_to_right,this._count=30,this._down_times++)},t.prototype.collided=function(n,t,i){if(n instanceof ShipBullet){var r=n;this._energy-=r._energy,this._energy<=0&&(i.add_score(this._score),t.remove_enemy(this))}},t}(Enemy),GameState=function(){function n(){}return n.prototype._resume=function(){var n=this.game_loop;this._timerToken=setInterval(function(){n()},33),this.paused=!1},n.prototype._suspend=function(){clearTimeout(this._timerToken),this.paused=!0},n.prototype.pause=function(){this.paused?this._resume():this._suspend()},n.prototype.add_score=function(n){this.score+=n},n.prototype.add_life=function(){this.lives++},n.prototype.loose_life=function(){return this.lives--,this.lives<=0},n.prototype.get_lives=function(){return this.lives},n}(),InvasionLevel=function(){function n(){var i=this,t,n;for(i._main=new Ship("main",500,500),i._enemies=[],i._enemy_bullets=[],i._ship_bullets=[],i._bonuses=[],t=0,n=0,n=0;n<10;n++)i._enemies.push(new Invader("enemy"+t+n,"blue",100+n*50,20+t*50));for(t++,n=0;n<10;n++)i._enemies.push(new Invader("enemy"+t+n,"red",100+n*50,20+t*50));for(t++,n=0;n<10;n++)i._enemies.push(new Invader("enemy"+t+n,"green",100+n*50,20+t*50));for(t++,n=0;n<10;n++)i._enemies.push(new Invader("enemy"+t+n,"yellow",100+n*50,20+t*50));for(t++,n=0;n<10;n++)i._enemies.push(new Invader("enemy"+t+n,"pink",100+n*50,20+t*50));for(t++,n=0;n<10;n++)i._enemies.push(new Invader("enemy"+t+n,"cyan",100+n*50,20+t*50))}return n.prototype.render_common=function(n,t){n.write("SCORE: "+t.score.toString(),10,20),n.write("LIVES: "+t.lives.toString(),10,45)},n.prototype.render=function(n,t){var i=this;n.clear(),i._enemies.forEach(function(t){t.render(n)}),i._enemy_bullets.forEach(function(t){t.render(n)}),i._ship_bullets.forEach(function(t){t.render(n)}),i._bonuses.forEach(function(t){t.render(n)}),i._main.render(n),i.render_common(n,t)},n.prototype.update=function(n){var t=this,r,i,u,f;for(t._enemies.forEach(function(i){i.update(t,n)}),t._enemy_bullets.forEach(function(i){i.update(t,n)}),t._ship_bullets.forEach(function(i){i.update(t,n)}),t._bonuses.forEach(function(i){i.update(t,n)}),t._main.update(t,n),r=0;;){if(t._enemies.length<=r)break;if(i=t._enemies[r],t._main.collides(i)){t._main.collided(i,t,n),i.collided(this._main,t,n);break}else for(u=0;;){if(t._ship_bullets.length<=u)break;f=t._ship_bullets[u],i.collides(f)&&(f.collided(i,t,n),i.collided(f,t,n)),u++}r++}},n.prototype.add_ship_bullet=function(n){this._ship_bullets.push(n)},n.prototype.add_enemy_bullet=function(n){this._enemy_bullets.push(n)},n.prototype.loose_life=function(n){var t=n.loose_life();return n.get_lives()==0&&n.on_end_game(),t},n.prototype.remove_enemy_bullet=function(n){var t=this,i=t._enemy_bullets.indexOf(n);t._enemy_bullets.splice(i,1)},n.prototype.remove_ship_bullet=function(n){var t=this._ship_bullets.indexOf(n);this._ship_bullets.splice(t,1)},n.prototype.remove_bonus=function(n){var t=this._bonuses.indexOf(n);this._bonuses.splice(t,1)},n.prototype.remove_enemy=function(n){var t=this._enemies.indexOf(n);this._enemies.splice(t,1)},n.prototype.add_energy_to_main=function(n){this._main.add_energy(n)},n.prototype.increase_shoot_power_to_main=function(){this._main.increase_shoot_power()},n.prototype.shoot=function(){this._main.shoot(this)},n.prototype.move_left=function(){this._main.move(-5,0)},n.prototype.move_right=function(){this._main.move(5,0)},n}(),SpriteSheet=function(){function n(n){this.frames=new Image,this.frames.src=n}return n}(),GameScreen=function(){function n(n){this._render_context=n}return n.prototype.clear=function(){this._render_context.clearRect(0,0,this._render_context.canvas.width,this._render_context.canvas.height)},n.prototype.draw=function(n,t,i){this._render_context.drawImage(n.frames,t,i)},n.prototype.write=function(n,t,i){this._render_context.strokeText(n,t,i)},n}(),Game=function(){function n(n){var i,t;this._game_screen=n,i=new InvasionLevel,this._game_context=i,t=new GameState,t.lives=3,t.score=0,t.paused=!0,t.game_loop=function(){i.render(n,t),i.update(t)},t.on_end_game=t._suspend,this._game_state=t}return n.prototype.shoot=function(){this._game_context.shoot()},n.prototype.move_left=function(){this._game_context.move_left()},n.prototype.move_right=function(){this._game_context.move_right()},n.prototype.pause=function(){this._game_state.pause()},n}();$(function(){var r=document.getElementById("main"),t=r.getContext("2d"),i,n;t.font="12pt Calibri",t.lineWidth=3,t.strokeStyle="blue",i=new GameScreen(t),n=new Game(i),window.onkeydown=function(t){switch(t.keyCode){case 77:n.move_right();break;case 78:n.move_left();break;case 90:n.shoot();break;case 80:n.pause()}},window.onkeyup=function(n){switch(n.keyCode){}},n.pause()})